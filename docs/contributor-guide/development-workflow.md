# Workflow разработки

Мы используем итеративный подход к разработке, начиная с прототипирования в `playground` и заканчивая фиксацией стабильных версий пакетов.

## 1. Этап Playground (Прототипирование)
*   **Где**: Основной репозиторий `vlmhyperbench_playground`.
*   **Что делаем**:
    *   Реализуем базовые абстрактные классы и компоненты ядра VLMHyperBench.
    *   Проводим быстрые эксперименты и проверку гипотез.
    *   Код пишется в режиме `dev` (editable packages).

## 2. Этап Integration (Подключение модулей)
*   **Что делаем**:
    *   Используем **динамическую композицию**. Пакеты плагинов живут в независимых репозиториях.
    *   Для разработки в `dev` режиме клонируем репозиторий пакета в локальную папку (`packages/`) и прописываем путь в `.dev.yaml` оверлее реестра.
    *   Оркестратор автоматически устанавливает такие пакеты в **editable** режиме (`pip install -e`) внутри контейнеров.

### Изоляция пакетов при разработке
Каждый пакет в `packages/` автономен и имеет свой `pyproject.toml`. Чтобы не засорять основной проект зависимостями плагинов, мы **не используем** `uv workspaces` в корне.

**Тестирование пакета в изоляции для unit тестов:**
```bash
cd packages/my_package
uv sync
uv run pytest
```

**Интеграционное тестирование (на хосте):**
```bash
# Использование временных зависимостей через uv run
uv run --with-editable ./packages/my_package pytest tests/integration
```

## 3. Этап Pipeline & Testing
*   **Что делаем**:
    *   Прогоняем полный пайплайн (Inference -> Eval -> Report) на тестовых данных.
    *   Убеждаемся, что все компоненты взаимодействуют корректно.
    *   Исправляем баги как в ядре, так и в подключаемых модулях.

### Запуск скриптов
Для запуска кода используйте `uv run`, это гарантирует актуальность окружения:
```bash
uv run python my_script.py
```
Или активируйте виртуальную среду вручную:
```bash
source .venv/bin/activate
python my_script.py
```

## 4. Этап Release (Фиксация версий)
*   **Что делаем**:
    *   Пушим работающие версии кода в соответствующие удаленные репозитории пакетов.
    *   Создаем git tags (например, `v0.1.0`) в репозиториях пакетов.
    *   В `uv.lock` (для `prod` профиля) фиксируем **точные версии пакетов** (через git tags), совместимые с текущей версией ядра.

### Работа с релизными режимами (RUN_MODE)
*   **dev**: Используются локальные пути из `.dev.yaml` оверлеев. Пакеты устанавливаются как editable.
*   **prod**: Используются стабильные версии из базовых YAML-реестров (Git tags, PyPI).

Подробнее о настройке режимов см. в разделе [Установка и настройка](../getting-started/installation.md).